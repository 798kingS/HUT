<Header title="发布帖子"></Header>

<view class="publish-container">
  <form bindsubmit="submitForm">
    <!-- 帖子信息 -->
    <view class="form-section">
      <view class="section-header">
        <text class="section-icon">📝</text>
        <text class="section-title">帖子信息</text>
      </view>
      <view class="form-group">
        <view class="input-field">
          <view class="input-label">
            <text class="label-icon">🔤</text>
            <text class="label-text">标题</text>
          </view>
          <view class="input-wrapper">
            <input class="form-input" name="title" placeholder="请输入帖子标题" value="{{formData.title}}" bindinput="inputChange" data-field="title" maxlength="50" />
            <text class="char-count">{{formData.title.length}}/50</text>
          </view>
        </view>
        <view class="input-field">
          <view class="input-label">
            <text class="label-icon">✏️</text>
            <text class="label-text">内容</text>
          </view>
          <view class="textarea-wrapper">
            <textarea class="form-textarea" name="content" placeholder="分享你的想法..." value="{{formData.content}}" bindinput="inputChange" data-field="content" maxlength="1000"></textarea>
            <text class="char-count">{{formData.content.length}}/1000</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 位置信息 -->
    <view class="form-section">
      <view class="section-header">
        <text class="section-icon">📍</text>
        <text class="section-title">位置信息</text>
      </view>
      <view class="form-group">
        <view class="input-field">
          <view class="input-label">
            <text class="label-icon">📌</text>
            <text class="label-text">发布位置</text>
          </view>
          <view class="input-wrapper">
            <input class="form-input" name="location" placeholder="请输入位置（选填）" value="{{formData.location}}" bindinput="inputChange" data-field="location" />
          </view>
        </view>
      </view>
    </view>

    <!-- 分类标签 -->
    <view class="form-section">
      <view class="section-header">
        <text class="section-icon">🏷️</text>
        <text class="section-title">分类标签</text>
      </view>
      <view class="form-group">
        <view class="input-field">
          <view class="input-label">
            <text class="label-icon">📂</text>
            <text class="label-text">选择分类</text>
          </view>
          <picker range="{{categories}}" value="{{categoryIndex}}" bindchange="categoryChange">
            <view class="picker-wrapper">
              <text class="picker-text">{{categories[categoryIndex] || '请选择分类'}}</text>
              <text class="picker-arrow">></text>
            </view>
          </picker>
        </view>
        <view class="tags-section">
          <view class="tags-label">
            <text class="label-icon">🏷️</text>
            <text class="label-text">添加标签</text>
          </view>
          <view class="selected-tags">
            <view class="tag-item" wx:for="{{selectedTags}}" wx:key="*this">
              <text class="tag-text">{{item}}</text>
              <text class="tag-remove" bindtap="removeTag" data-tag="{{item}}">×</text>
            </view>
          </view>
          <view class="suggested-tags">
            <text class="suggestion-title">推荐标签：</text>
            <view class="suggestion-list">
              <text class="suggestion-tag" wx:for="{{suggestedTags}}" wx:key="*this" bindtap="addTag" data-tag="{{item}}">{{item}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- 图片上传 -->
    <view class="form-section">
      <view class="section-header">
        <text class="section-icon">🖼️</text>
        <text class="section-title">图片上传</text>
      </view>
      <view class="upload-section">
        <view class="upload-grid">
          <view class="upload-item" wx:for="{{images}}" wx:key="*this">
            <image src="{{item}}" mode="aspectFill" class="upload-image"></image>
            <view class="upload-delete" bindtap="deleteImage" data-index="{{index}}">×</view>
          </view>
          <view class="upload-add" bindtap="chooseImage" wx:if="{{images.length < 9}}">
            <text class="add-icon">+</text>
            <text class="add-text">添加图片</text>
          </view>
        </view>
        <text class="upload-tip">最多上传9张图片</text>
      </view>
    </view>

    <!-- 发布设置 -->
    <view class="form-section">
      <view class="section-header">
        <text class="section-icon">⚙️</text>
        <text class="section-title">发布设置</text>
      </view>
      <view class="settings-group">
        <view class="setting-item">
          <view class="setting-info">
            <text class="setting-icon">💬</text>
            <text class="setting-label">允许评论</text>
          </view>
          <switch checked="{{formData.allowComment}}" bindchange="commentSwitchChange" color="#667eea" />
        </view>
        <view class="setting-item">
          <view class="setting-info">
            <text class="setting-icon">👤</text>
            <text class="setting-label">匿名发布</text>
          </view>
          <switch checked="{{formData.anonymous}}" bindchange="anonymousSwitchChange" color="#667eea" />
        </view>
      </view>
    </view>

    <!-- 提交按钮 -->
    <view class="submit-section">
      <button class="submit-btn" form-type="submit" loading="{{submitting}}">
        <text class="submit-icon">🚀</text>
        <text class="submit-text">{{submitting ? '发布中...' : '发布帖子'}}</text>
      </button>
    </view>
  </form>
</view> 