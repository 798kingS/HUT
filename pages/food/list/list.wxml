<!--pages/food/list/list.wxml-->
<Header title="å¤–å–æ¥å•"></Header>

<view class="food-container">
  <!-- æ¬¢è¿æ¨ªå¹… -->
  <view class="welcome-banner">
    <view class="banner-bg">
      <view class="banner-gradient"></view>
      <view class="banner-pattern"></view>
    </view>
    <view class="banner-content">
      <view class="welcome-text">
        <text class="greeting">ğŸ½ï¸ å¤–å–æ¥å•</text>
        <text class="subtitle">è®©ç¾é£Ÿæ›´å¿«é€è¾¾</text>
      </view>
      <view class="orders-stats">
        <text class="stats-number">{{ordersList.length}}</text>
        <text class="stats-label">å¯ç”¨è®¢å•</text>
      </view>
    </view>
  </view>

  <!-- æ™ºèƒ½æœç´¢ -->
  <view class="smart-search">
    <view class="search-wrapper">
      <view class="search-input {{searchFocus ? 'focus' : ''}}">
        <image src="/images/æœç´¢.png" class="search-icon"></image>
        <input class="input-field" placeholder="æœç´¢é¤å…ã€èœå“ã€åœ°å€..." value="{{searchKeyword}}" bindinput="onSearchInput" focus="{{searchFocus}}" bindfocus="onSearchFocus" bindblur="onSearchBlur" />
      </view>
      <button class="search-btn" bindtap="search">
        <text class="search-text">æœç´¢</text>
      </button>
    </view>
  </view>

  <!-- å¿«é€Ÿå‘å¸ƒ -->
  <view class="quick-publish">
    <view class="quick-publish-header">
      <text class="quick-title">ğŸ’¬ å¿«é€Ÿå‘å¸ƒ</text>
      <text class="quick-subtitle">ç›´æ¥è¾“å…¥éœ€æ±‚ï¼Œç³»ç»Ÿè‡ªåŠ¨è§£æ</text>
    </view>
    <view class="quick-input-wrapper">
      <textarea class="quick-input" placeholder="ä¾‹å¦‚ï¼šå¸®æˆ‘ä»éº¦å½“åŠ³å¸¦ä¸ªæ±‰å ¡å¥—é¤åˆ°å®¿èˆï¼Œä½£é‡‘5å…ƒ" value="{{quickText}}" bindinput="onQuickInput" maxlength="200"></textarea>
      <view class="quick-actions">
        <text class="char-count">{{quickText.length}}/200</text>
        <button class="quick-publish-btn" bindtap="quickPublish">
          <text class="btn-text">å‘å¸ƒ</text>
        </button>
      </view>
    </view>
  </view>

  <!-- åˆ†ç±»ç­›é€‰ -->
  <view class="category-filters">
    <view class="filter-item {{currentFilter === 'all' ? 'active' : ''}}" bindtap="setFilter" data-filter="all">
      <image src="/images/å…¨éƒ¨.png" class="filter-icon"></image>
      <text class="filter-text">å…¨éƒ¨è®¢å•</text>
    </view>
    <view class="filter-item {{currentFilter === 'å¾…æ¥å•' ? 'active' : ''}}" bindtap="setFilter" data-filter="å¾…æ¥å•">
      <image src="/images/ä»Šå¤©.png" class="filter-icon"></image>
      <text class="filter-text">æœªè¢«æ¥å•</text>
    </view>
    <view class="filter-item {{currentFilter === 'myPosts' ? 'active' : ''}}" bindtap="setFilter" data-filter="myPosts">
      <image src="/images/æˆ‘çš„å‘å¸ƒ.png" class="filter-icon"></image>
      <text class="filter-text">æˆ‘å‘å¸ƒçš„</text>
    </view>
    <view class="filter-item {{currentFilter === 'myHelp' ? 'active' : ''}}" bindtap="setFilter" data-filter="myHelp">
      <image src="/images/æˆ‘çš„æ”¶è—.png" class="filter-icon"></image>
      <text class="filter-text">æˆ‘å¸®åŠ©çš„</text>
    </view>
  </view>

  <!-- è®¢å•åˆ—è¡¨ -->
  <view class="orders-section">
    <view class="orders-list">
      <view class="order-card" wx:for="{{ordersList}}" wx:key="id" bindtap="viewOrderDetail" data-order="{{item}}">
        <view class="card-header">
          <view class="order-cover-section">
            <image src="{{item.restaurantImage || '/images/é¤å….png'}}" class="order-cover"></image>
            <view class="order-status">
              <text class="status-text">{{item.status}}</text>
            </view>
          </view>
          <view class="order-info">
            <text class="order-title">{{item.restaurant}} - {{item.foodName}}</text>
            <text class="order-category">å¤–å–é…é€</text>
            <view class="order-tags">
              <text class="tag-item">{{item.location || 'ä¸œåŒº'}}</text>
            </view>
          </view>
          <view class="commission-section">
            <text class="commission-symbol">Â¥</text>
            <text class="commission-amount">{{item.commission || 5}}</text>
          </view>
        </view>
        
        <view class="order-description">
          <text class="desc-text">{{item.description}}</text>
          <text class="commission-after">ä½£é‡‘ Â¥{{item.commission || 0}}</text>
        </view>
        
        <view class="customer-section">
          <view class="customer-info">
            <view class="customer-avatar">
              <image src="{{item.customerAvatar}}" class="avatar-img"></image>
              <view class="online-indicator"></view>
            </view>
            <view class="customer-details">
              <text class="customer-name">{{item.customerName}}</text>
              <text class="order-time">{{item.orderTime}}</text>
            </view>
          </view>
          <view class="order-actions">
            <view class="action-btn" catchtap="contactCustomer" data-order="{{item}}">
              <text class="action-icon">ğŸ’¬</text>
              <text class="action-text">è”ç³»</text>
            </view>
            <!-- æ–°å¢ï¼šåˆ é™¤æŒ‰é’®ï¼ˆä»…è‡ªå·±å‘å¸ƒçš„è®¢å•æ˜¾ç¤ºï¼‰ -->
            <view class="action-btn delete-btn" 
                  catchtap="showDeleteConfirm"
                  data-id="{{item.id}}"
                  wx:if="{{item.customerName === 'æˆ‘å‘å¸ƒçš„'}}">
              <text class="action-icon">ğŸ—‘ï¸</text>
              <text class="action-text">åˆ é™¤</text>
            </view>
        </view>

        <!-- æ¥å•æŒ‰é’®åŒºåŸŸ -->
        <view class="order-buttons" catchtap="stopPropagation">
          <button class="take-order-btn" catchtap="takeOrder" data-id="{{item.id}}" wx:if="{{item.status === 'å¾…æ¥å•'}}">
            ç«‹å³æ¥å•
          </button>
          <button class="take-order-btn accepted" catchtap="viewOrderDetail" data-order="{{item}}" wx:elif="{{item.status === 'å·²æ¥å•'}}">
            å·²æ¥å•
          </button>
          <button class="take-order-btn delivering" catchtap="viewOrderDetail" data-order="{{item}}" wx:elif="{{item.status === 'é…é€ä¸­'}}">
            é…é€ä¸­
          </button>
          <button class="take-order-btn completed" catchtap="viewOrderDetail" data-order="{{item}}" wx:elif="{{item.status === 'å·²å®Œæˆ'}}">
            å·²å®Œæˆ
          </button>
          
          <!-- å–é¤æŒ‰é’® -->
          <button class="pickup-btn" catchtap="pickupOrder" data-id="{{item.id}}" wx:if="{{item.status === 'å·²æ¥å•'}}">
            å–é¤
          </button>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more-section" wx:if="{{hasMore}}">
      <button class="load-more-btn" bindtap="loadMore" loading="{{loading}}">
        <text class="load-text">{{loading ? 'åŠ è½½ä¸­...' : 'åŠ è½½æ›´å¤š'}}</text>
        <text class="load-icon">â†“</text>
      </button>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{ordersList.length === 0 && !loading}}">
      <view class="empty-content">
        <text class="empty-icon">ğŸ½ï¸</text>
        <text class="empty-title">æš‚æ— å¤–å–è®¢å•</text>
        <text class="empty-desc">å¿«æ¥å‘å¸ƒç¬¬ä¸€ä¸ªå¤–å–éœ€æ±‚ï¼Œè®©ç¾é£Ÿæ›´å¿«é€è¾¾</text>
        <button class="empty-action" bindtap="goToPublish">ç«‹å³å‘å¸ƒ</button>
      </view>
    </view>
  </view>
  </view>
</view>


