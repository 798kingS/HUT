<!--pages/word/word.wxml-->
<view class="custom-navbar">
  <view class="navbar-bg"></view>
  <view class="navbar-content">
    <text class="navbar-title">æ¶ˆæ¯ä¸­å¿ƒ</text>
  </view>
</view>

<view class="word-container">
  <!-- æ¬¢è¿æ¨ªå¹… -->
  <view class="welcome-banner">
    <view class="banner-bg">
      <view class="banner-gradient"></view>
      <view class="banner-pattern"></view>
    </view>
    <view class="banner-content">
      <view class="welcome-text">
        <text class="greeting">ğŸ“¬ æ¶ˆæ¯ä¸­å¿ƒ</text>
        <text class="subtitle">å®æ—¶æŸ¥çœ‹å„ç±»æ¶ˆæ¯è¿›åº¦</text>
      </view>
      <view class="messages-stats">
        <text class="stats-number">{{messagesList.length}}</text>
        <text class="stats-label">æ¡æ¶ˆæ¯</text>
      </view>
    </view>
  </view>

  <!-- åˆ†ç±»ç­›é€‰ -->
  <view class="category-filters">
    <view class="filter-item {{currentFilter === 'all' ? 'active' : ''}}" bindtap="setFilter" data-filter="all">
      <text class="filter-text">å…¨éƒ¨</text>
    </view>
    <view class="filter-item {{currentFilter === 'æ‹¼è½¦' ? 'active' : ''}}" bindtap="setFilter" data-filter="æ‹¼è½¦">
      <text class="filter-text">æ‹¼è½¦</text>
    </view>
    <view class="filter-item {{currentFilter === 'å‡ºå”®' ? 'active' : ''}}" bindtap="setFilter" data-filter="å‡ºå”®">
      <text class="filter-text">å‡ºå”®</text>
    </view>
    <view class="filter-item {{currentFilter === 'å¤–å–' ? 'active' : ''}}" bindtap="setFilter" data-filter="å¤–å–">
      <text class="filter-text">å¤–å–</text>
    </view>
  </view>

  <!-- æ¶ˆæ¯åˆ—è¡¨ -->
  <view class="messages-section">
    <view class="messages-list">
      <view class="message-card" wx:for="{{messagesList}}" wx:key="id" bindtap="viewMessageDetail" data-message="{{item}}">
        <view class="card-header">
          <view class="message-avatar">
            <image src="{{item.avatar}}" class="avatar-img"></image>
            <view class="online-dot"></view>
          </view>
          <view class="message-info">
            <view class="message-title-row">
              <text class="message-title">{{item.title}}</text>
              <view class="message-badge {{item.type === 'æ‹¼è½¦' ? 'carpool-badge' : item.type === 'å‡ºå”®' ? 'sell-badge' : 'food-badge'}}">
                {{item.type}}
              </view>
            </view>
            <text class="message-desc">{{item.description}}</text>
          </view>
        </view>
        
        <!-- è¿›åº¦çŠ¶æ€ -->
        <view class="progress-section">
          <view class="progress-bar">
            <view class="progress-fill {{item.statusClass}}" style="width: {{item.progress}}%"></view>
          </view>
          <view class="progress-info">
            <text class="progress-status {{item.statusClass}}">{{item.status}}</text>
            <text class="progress-time">{{item.time}}</text>
          </view>
        </view>

        <!-- æ¶ˆæ¯è¯¦æƒ… -->
        <view class="message-details">
          <view class="detail-item" wx:if="{{item.departure}}">
            <text class="detail-label">å‡ºå‘åœ°ï¼š</text>
            <text class="detail-value">{{item.departure}}</text>
          </view>
          <view class="detail-item" wx:if="{{item.destination}}">
            <text class="detail-label">ç›®çš„åœ°ï¼š</text>
            <text class="detail-value">{{item.destination}}</text>
          </view>
          <view class="detail-item" wx:if="{{item.restaurant}}">
            <text class="detail-label">é¤å…ï¼š</text>
            <text class="detail-value">{{item.restaurant}}</text>
          </view>
          <view class="detail-item" wx:if="{{item.foodName}}">
            <text class="detail-label">èœå“ï¼š</text>
            <text class="detail-value">{{item.foodName}}</text>
          </view>
          <view class="detail-item" wx:if="{{item.bookName}}">
            <text class="detail-label">ä¹¦ç±ï¼š</text>
            <text class="detail-value">{{item.bookName}}</text>
          </view>
          <view class="detail-item" wx:if="{{item.itemName}}">
            <text class="detail-label">ç‰©å“ï¼š</text>
            <text class="detail-value">{{item.itemName}}</text>
          </view>
          <view class="detail-item" wx:if="{{item.price}}">
            <text class="detail-label">ä»·æ ¼ï¼š</text>
            <text class="detail-value price">Â¥{{item.price}}</text>
          </view>
        </view>

        <!-- æ“ä½œæŒ‰é’® -->
        <view class="message-actions" catchtap="stopPropagation">
          <button class="action-btn primary" bindtap="handleMessage" data-id="{{item.id}}" data-type="{{item.type}}" wx:if="{{item.status === 'å¾…æ¥å•' || item.status === 'å¾…ç¡®è®¤'}}">
            {{item.type === 'å¤–å–' ? 'æ¥å•' : item.type === 'æ‹¼è½¦' ? 'ç¡®è®¤' : 'è”ç³»'}}
          </button>
          <button class="action-btn secondary" bindtap="viewMessageDetail" data-message="{{item}}" wx:else>
            æŸ¥çœ‹è¯¦æƒ…
          </button>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{messagesList.length === 0 && !loading}}">
      <view class="empty-content">
        <text class="empty-icon">ğŸ“­</text>
        <text class="empty-title" wx:if="{{hasLogin}}">æš‚æ— æ¶ˆæ¯</text>
        <text class="empty-title" wx:else>è¯·å…ˆç™»å½•</text>
        <text class="empty-desc" wx:if="{{hasLogin}}">æ‚¨çš„æ¶ˆæ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º</text>
        <text class="empty-desc" wx:else>ç™»å½•åæŸ¥çœ‹æ‚¨çš„æ‹¼è½¦ã€å¤–å–ã€å‡ºå”®ç­‰æ¶ˆæ¯</text>
        <button class="empty-action" wx:if="{{!hasLogin}}" bindtap="goToLogin">å»ç™»å½•</button>
      </view>
    </view>
  </view>
</view>